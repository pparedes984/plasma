/*
 * File: app.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

// @require @packageOverrides
Ext.Loader.setConfig({

});


Ext.application({
    models: [
        'Institucion_Model',
        'Marcador_Model',
        'Kit_Model',
        'Usuario_Model',
        'Codigo_Model',
        'Casa_Model',
        'Rol_Model',
        'Muestra_Model',
        'Estados_Model',
        'Pruebas_Model'
    ],
    stores: [
        'Institucion',
        'Codigo',
        'Kit',
        'Marcador',
        'Usuario',
        'Casa',
        'Rol',
        'Muestra',
        'Estado',
        'Situacion',
        'Status',
        'Pruebas',
        'Interpretacion'
    ],
    views: [
        'vwprtLogin',
        'vwprtPrincipal',
        'pnlInstitucion',
        'pnlMarcador',
        'pnlKit',
        'pnlCodigo',
        'pnlMuestras',
        'pnlUsuarios',
        'wndUsuario',
        'wndInstitucion',
        'wndMarcador',
        'wndKit',
        'wndCodigo',
        'pnlNuevoMuestra'
    ],
    name: 'plasma',

    launch: function() {
        Ext.Ajax.request(
            {
                url: '../servidor/login/sesiones',
                method: 'post',
                scope: this,
                success: function(response, opts)
                {
                    var responseData = Ext.JSON.decode(response.responseText);
                    if(responseData.success)
                    {
                        VERIFICADO = responseData.data.verified;


                        if(VERIFICADO){

                            if(responseData.data.rolAp_apps === null){
                                Ext.create('plasma.view.vwprtLogin', {renderTo: Ext.getBody()});
                            }
                            else{

                                Ext.create('plasma.view.vwprtPrincipal', {renderTo: Ext.getBody()});
                                Ext.getCmp('menuUsuarios').setVisible(false);
                                if(responseData.data.rolAp_apps[0].rol === 1)
                                    Ext.getCmp('menuUsuarios').setVisible(true);
                                Ext.getCmp('idUsuario').setText('Usuario: '+responseData.data.nombre_apps);


                            }
                        }
                        else
                        {
                            Ext.create('plasma.view.vwprtLogin', {renderTo: Ext.getBody()});
                        }

                    }else{
                        Ext.create('plasma.view.vwprtLogin', {renderTo: Ext.getBody()});
                    }

                },

                failure: function(response, opts)
                {
                    Ext.Msg.show({
                        title:'Error',
                        msg: 'Usuario o clave mal ingresados',
                        buttons: Ext.Msg.OK,
                        icon: Ext.MessageBox.WARNING
                    });
                }
            });
    }

});
