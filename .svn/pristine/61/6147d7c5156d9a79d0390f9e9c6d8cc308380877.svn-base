/*
 * File: app/view/wndUsuarioViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('plasma.view.wndUsuarioViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.wndusuario',

    onBtnCrearUsClick: function(button, e, eOpts) {
        var store =  Ext.getStore('Usuario');
        var data =  store.data.items;
        var aux = 0;
        for(var i = 0; i< data.length;i++)
        {
            if(data[i].data.usuario === Ext.getCmp('txtUsuario').getValue())
            aux++;
        }
        if(aux === 0)
        {var me = this;
            var forma = Ext.getCmp('frmNuevoUs').getForm(),
                store = Ext.getStore('Usuario');
            if (forma.isValid()) {
                var values = forma.getValues();
                Ext.Ajax.request({
                    url: '../servidor/plasma/usuario/create',
                    method:"post",
                    params: {
                        data: Ext.encode(values)
                    },
                    success: function( result, request ) {
                        var responseData = Ext.JSON.decode(result.responseText);
                        if(responseData.success)
                        {

                            Ext.Msg.alert('Aviso','Se ha ingresado el usuario');
                            Ext.getCmp('txtUsuario').setValue(null);
                            Ext.getCmp('txtCedula').setValue(null);
                            Ext.getCmp('txtNombre').setValue(null);
                            Ext.getCmp('cbEstado').setValue(null);
                            Ext.getCmp('cbRolUs').setValue(null);
                            Ext.getCmp('txtEmail').setVisible(false);

                            Ext.getCmp('txtUsuario').reset();
                            Ext.getCmp('txtCedula').reset();
                            Ext.getCmp('txtNombre').reset();
                            Ext.getCmp('cbEstado').reset();
                            Ext.getCmp('cbRolUs').reset();
                            Ext.getCmp('txtEmail').reset();

                            store.load();
                            Ext.getCmp('wndUsuario').close();




                        }
                        else
                        {
                            Ext.Msg.alert('Alerta','Faltan datos');
                        }
                    },

                    failure: function(response, opts) {
                        console.log('server-side failure with status code ' + response.status);
                    }
                });
            }
            else
            {
                Ext.Msg.alert('Atención','Los datos son incorrectos o se encuentran incompletos');

            }
        }
        else
        {
            Ext.Msg.alert('Atención','El usuario ya existe');
        }

    },

    onBtnRegresarUsClick: function(button, e, eOpts) {
        Ext.getCmp('wndUsuario').close();
    }

});
