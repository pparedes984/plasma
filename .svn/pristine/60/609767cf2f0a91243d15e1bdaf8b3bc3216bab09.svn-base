/*
 * File: app/view/pnlNuevoMuestraViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('plasma.view.pnlNuevoMuestraViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.pnlnuevomuestra',

    onCbInstitucionSelect: function(combo, record, eOpts) {
        Ext.Ajax.request({
            method: 'post',
            url: '../servidor/plasma/muestra/getcodigoins',
            params: {
                casa: record.data.casa_comercial,
            },
            success: function (response, options) {
                var responseData = Ext.JSON.decode(response.responseText);
                console.log(responseData.data[0].nombre);
                Ext.getCmp('txtCasaM').setValue(responseData.data[0].nombre);
            }
        });
    },

    onCbKitMSelect: function(combo, record, eOpts) {


        Ext.Ajax.request({
            method: 'post',
            url: '../servidor/plasma/casacomercial/getCasa',
            params: {
                casa: record.data.casa_comercial,
            },
            success: function (response, options) {
                var responseData = Ext.JSON.decode(response.responseText);
                console.log(responseData.data[0].nombre);
                Ext.getCmp('txtCasaM').setValue(responseData.data[0].nombre);
            }
        });
    },

    onBtnMarcadorMasClick: function(button, e, eOpts) {



        var panel = Ext.create('Ext.panel.Panel', {
            margin: '10 10 10 10',
            layout : {
                type  : 'vbox',
                pack  : 'center',
                align : 'middle'
            },

            items:[

            {
                xtype: 'combobox',
                id: 'cbMarcador'+I,
                fieldLabel: 'Marcador Serológico',
                name: 'marcador',
                allowBlank: false,
                editable: false,
                displayField: 'nombre',
                queryMode: 'local',
                store: 'Marcador',
                valueField: 'codigo'
            },
            {
                xtype: 'textfield',
                id: 'txtAbsCol'+I,
                fieldLabel: 'Abs/COl',
                name: 'abs_co',
                allowBlank: false
            }

            ],
            renderTo: Ext.getBody()
        });

        I=I+1;
        Ext.getCmp('frmRecepcion1').add(panel);


    },

    onBtnGuardarMuestraClick: function(button, e, eOpts) {
        var me = this;
        var forma = Ext.getCmp('frmRecepcion').getForm();
        var forma1 = Ext.getCmp('frmRecepcion1').getForm();
        if (forma.isValid() && forma1.isValid()) {
            var values = forma.getValues();
            var values1 = forma1.getValues();
            Ext.Ajax.request({
                url: '../servidor/plasma/muestra/guardar',
                method:"post",
                params: {
                    data: Ext.encode(values),
                    data1: Ext.encode(values1)
                },
                success: function( result, request ) {
                    var responseData = Ext.JSON.decode(result.responseText);
                    if(responseData.success)
                    {
                        console.log(responseData);

                        Ext.Msg.alert('Aviso','Se ha ingresado la muestra');
                        I=0;
                        Ext.getCmp('frmRecepcion').reset();
                        Ext.getCmp('frmRecepcion1').reset();

                    }
                    else
                    {
                        Ext.Msg.alert('Alerta','Faltan datos');
                    }
                },

                failure: function(response, opts) {
                    console.log('server-side failure with status code ' + response.status);
                }
            });
            /*Ext.Ajax.request({
            url: '../servidor/plasma/muestramarcador/guardar',
            method:"post",
            params: {

            data1: Ext.encode(values1)
            },
            success: function( result, request ) {
            var responseData = Ext.JSON.decode(result.responseText);
            if(responseData.success)
            {

            Ext.Msg.alert('Aviso','Se ha ingresado la muestra');
            I=0;
            Ext.getCmp('frmRecepcion').reset();
            Ext.getCmp('frmRecepcion1').reset();

            }
            else
            {
            Ext.Msg.alert('Alerta','Faltan datos');
            }
            },

            failure: function(response, opts) {
            console.log('server-side failure with status code ' + response.status);
            }
            });*/
        }
        else
        {
            Ext.Msg.alert('Atención','Los datos son incorrectos o se encuentran incompletos');

        }



    },

    onBtnCancelarMuestraClick: function(button, e, eOpts) {

    }

});
